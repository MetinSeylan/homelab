- name: Argocd Helm Repo
  shell: helm repo add argo-cd https://argoproj.github.io/argo-helm

- name: Get Homelab Repo
  ansible.builtin.git:
    repo: https://github.com/MetinSeylan/homelab.git
    dest: /home/metin/homelab

- name: Helm dep update
  shell: helm dep update /home/metin/homelab/apps/controlplane/charts/argo-cd/

- name: Install Argocd
  shell: helm install argo-cd -n argo-cd --create-namespace /home/metin/homelab/apps/controlplane/charts/argo-cd/
  environment:
    KUBECONFIG: /etc/kubernetes/admin.conf

- name: Install Argo System
  shell: helm template /home/metin/homelab/apps/controlplane/system/ | kubectl apply -f -
  environment:
    KUBECONFIG: /etc/kubernetes/admin.conf

- name: Install Argo Deployments
  shell: helm template /home/metin/homelab/apps/controlplane/deployments/ | kubectl apply -f -
  environment:
    KUBECONFIG: /etc/kubernetes/admin.conf